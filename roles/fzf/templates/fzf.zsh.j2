# {{ ansible_managed }}
# fzf configuration for zsh

# Setup fzf
# ---------
if command -v asdf >/dev/null 2>&1 && asdf where fzf >/dev/null 2>&1; then
  export FZF_BASE="$(asdf where fzf)"
  
  # Auto-completion
  # ---------------
  [[ $- == *i* ]] && [[ -f "${FZF_BASE}/shell/completion.zsh" ]] && source "${FZF_BASE}/shell/completion.zsh" 2> /dev/null
  
  # Key bindings
  # ------------
  [[ -f "${FZF_BASE}/shell/key-bindings.zsh" ]] && source "${FZF_BASE}/shell/key-bindings.zsh"
fi

# Default command
# ---------------
export FZF_DEFAULT_COMMAND='fd --type f --hidden --follow --exclude .git'

# Default options
# ---------------
export FZF_DEFAULT_OPTS='
  --height 40% --layout=reverse --border --preview "bat --style=numbers --color=always --line-range :500 {}" --preview-window=right:60%:wrap
  --color=dark
  --color=fg:-1,bg:-1,hl:#5fff87,fg+:-1,bg+:-1,hl+:#ffaf5f
  --color=info:#af87ff,prompt:#5fff87,pointer:#ff87d7,marker:#ff87d7,spinner:#ff87d7
'

# CTRL-T - Paste the selected file path(s) into the command line
export FZF_CTRL_T_COMMAND="${FZF_DEFAULT_COMMAND}"
export FZF_CTRL_T_OPTS="
  --preview 'bat --style=numbers --color=always --line-range :500 {}'
  --preview-window=right:60%:wrap
"

# CTRL-R - Paste the selected command from history
export FZF_CTRL_R_OPTS="
  --preview 'echo {}'
  --preview-window=down:3:hidden:wrap
  --bind '?:toggle-preview'
"

# ALT-C - cd into the selected directory
export FZF_ALT_C_COMMAND="fd --type d --hidden --follow --exclude .git"
export FZF_ALT_C_OPTS="
  --preview 'tree -C {} | head -200'
"

# Advanced customizations
# -----------------------

# Use fd for path completion
_fzf_compgen_path() {
  fd --hidden --follow --exclude ".git" . "$1"
}

# Use fd to generate the list for directory completion
_fzf_compgen_dir() {
  fd --type d --hidden --follow --exclude ".git" . "$1"
}